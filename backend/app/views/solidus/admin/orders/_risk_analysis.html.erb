<fieldset class="no-border-bottom" id="risk_analysis">
  <legend><%= "#{Solidus.t(:risk_analysis)}: #{Solidus.t(:not) unless @order.is_risky?} #{Solidus.t(:risky)}" %></legend>
  <table>
    <thead>
      <th><%= Solidus.t('risk')%></th>
      <th><%= Solidus.t('status')%></th>
    </thead>
    <tbody id="risk-analysis" data-hook="order_details_adjustments"  class="with-border">
      <tr class="">
        <td><strong>
          <%= Solidus.t(:failed_payment_attempts) %>:
        </strong></td>
          <td class="align-center">
            <span class="<%= @order.payments.failed.count > 0 ? 'state void' : 'state complete' %>">
              <%= link_to "#{Solidus.t 'payments_count', count: @order.payments.failed.count, default: pluralize(@order.payments.failed.count, Solidus.t(:payment))}", spree.admin_order_payments_path(@order) %>
            </span>
        </td>
      </tr>

      <tr>
        <td><strong><%= Solidus.t(:avs_response) %>:</strong></td>
        <td class="align-center">
          <span class="<%= latest_payment.is_avs_risky? ? 'state void' : 'state complete' %>">
            <% if latest_payment.is_avs_risky? %>
              <%= "#{Solidus.t(:error)}: #{avs_response_code[latest_payment.avs_response]}" %>
            <% else %>
              <%= Solidus.t(:success) %>
            <% end %>
          </span>
        </td>
      </tr>

      <tr>
        <td><strong><%= Solidus.t(:cvv_response) %>:</strong></td>
        <td class="align-center">
          <span class="<%= latest_payment.is_cvv_risky? ? 'state void' : 'state complete' %>">
            <% if latest_payment.is_cvv_risky? %>
              <%= "#{Solidus.t(:error)}: #{cvv_response_code[latest_payment.cvv_response_code]}" %>
            <% else %>
              <%= Solidus.t(:success) %>
            <% end %>
          </span>
        </td>
      </tr>
    </tbody>
  </table>
</fieldset>
