<% content_for :page_title do %>
  <%= link_to "#{Solidus.t(:editing_user)} #{@user.email}", edit_admin_user_url(@user) %>
<% end %>

<%= render :partial => 'solidus/admin/users/sidebar', :locals => { :current => :account } %>
<%= render :partial => 'solidus/admin/users/user_page_actions' %>

<fieldset data-hook="admin_user_edit_general_settings" class="alpha twelve columns">
  <legend><%= Solidus.t(:general_settings) %></legend>

  <div data-hook="admin_user_edit_form_header">
    <%= render :partial => 'solidus/shared/error_messages', :locals => { :target => @user } %>
  </div>

  <div data-hook="admin_user_edit_form">
    <%= form_for [:admin, @user], as: :user, url: admin_user_url(@user), method: :put do |f| %>
      <%= render :partial => 'form', :locals => { :f => f } %>

      <% if can?(:update, @user) %>
        <div data-hook="admin_user_edit_form_button">
          <%= render :partial => 'solidus/admin/shared/edit_resource_links', :locals => { :collection_url => admin_users_url } %>
        </div>
      <% end %>
    <% end %>
  </div>
</fieldset>

<% if can?(:update, @user) %>
  <fieldset data-hook="admin_user_api_key" id="admin_user_edit_api_key" class="alpha twelve columns">
    <legend><%= Solidus.t('access', :scope => 'api') %></legend>

    <% if @user.solidus_api_key.present? %>
      <div class="field">
        <div id="current-api-key"><%= Solidus.t('key', :scope => 'api') %>: (<%= Solidus.t('hidden') %>)</div>
      </div>
      <div class="filter-actions actions">
        <%= form_tag solidus.clear_api_key_admin_user_path(@user), :method => :put do %>
          <%= button Solidus.t('clear_key', :scope => 'api'), 'trash' %>
        <% end %>

        <span class="or"><%= Solidus.t(:or)%></span>

        <%= form_tag solidus.generate_api_key_admin_user_path(@user), :method => :put do %>
          <%= button Solidus.t('regenerate_key', :scope => 'api'), 'refresh' %>
        <% end %>
      </div>

    <% else %>

      <div class="no-objects-found"><%= Solidus.t('no_key', :scope => 'api') %></div>

      <div class="filter-actions actions">
        <%= form_tag solidus.generate_api_key_admin_user_path(@user), :method => :put do %>
          <%= button Solidus.t('generate_key', :scope => 'api'), 'key' %>
        <% end %>
      </div>
    <% end %>
  </fieldset>
<% end %>
